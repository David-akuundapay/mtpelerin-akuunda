<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Akuunda Pay - Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="referrer" content="no-referrer-when-downgrade">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: url('https://raw.githubusercontent.com/David-akuundapay/mtpelerin-akuunda/main/mtpelerin-akuunda/images/Business%20Card%20-%20Front.png') center/cover no-repeat fixed;
      display: flex; justify-content: center; align-items: center; min-height: 100vh;
    }
    .container { width: 100%; max-width: 460px; padding: 20px; }
    .header { text-align: center; margin-bottom: 0; }
    .hero-image {
      width: 110%; max-width: 110%; border-radius: 16px;
      border: 5px solid #FFFFFF;
      box-shadow: 0 10px 30px rgba(57, 22, 89, 0.4);
    }
    .header h1, .header p, .service-indicator { display: none; }
    .error-message, .loading { display: none; }
    .widget-container { display: block; }
    iframe {
      width: 100%; height: 680px; border: none; border-radius: 20px; background: white;
      box-shadow: 0 25px 50px rgba(57, 22, 89, 0.4);
    }
    .akuunda-footer {
      text-align: center; margin-top: 25px; color: #FFFFFF; font-size: 1rem;
      text-shadow: 1px 1px 4px rgba(57, 22, 89, 0.6); font-weight: 500;
      background: linear-gradient(135deg, #FFFFFF 0%, #F88809 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://raw.githubusercontent.com/David-akuundapay/mtpelerin-akuunda/main/mtpelerin-akuunda/images/brand-hero.jpg" alt="Akuunda Pay" class="hero-image">
    </div>

    <div class="widget-container" id="widgetContainer">
      <iframe id="widget" allow="usb; ethereum; clipboard-write; payment;" loading="eager" title="Akuunda Pay - Exchange Platform"></iframe>
    </div>
    
    <div class="akuunda-footer">ðŸ’³ Service sÃ©curisÃ© par Akuunda Pay</div>
  </div>

  <script>
    const CONFIG = {
      API_TOKEN: '1c7a15d7-7243-4a77-a04e-c2b74061fa88'
    };

    const BRANDING = {
      primaryColor: 'F88809',
      primaryTextColor: 'FFFFFF',
      secondaryColor: 'FFA500',
      background: 'F8F9FA',
      successColor: 'F88809',
      warningColor: 'FF8C00',
      infoColor: 'F88809',
      lang: 'auto',
      hideNetworkSwitch: 'true',
      display: 'direct'
    };

    function parseUrlParameters() {
      const urlParams = new URLSearchParams(window.location.search);
      const params = {};
      for (const [key, value] of urlParams.entries()) {
        params[key] = value;
      }
      let tab = (params.tab || '').toLowerCase();
      if (tab !== 'buy' && tab !== 'sell') return { valid: false };

      const required = tab === 'buy' ? ['bsc', 'bdc'] : ['ssc', 'sdc'];
      const valid = required.every(k => params[k]);
      return valid ? { valid: true, params, tab } : { valid: false };
    }

    function formatWidgetUrl(params, tab) {
      const baseParams = {
        '_ctkn': CONFIG.API_TOKEN,
        'tab': tab,
        'tabs': tab,
        'hideTabs': 'true',
        'display': BRANDING.display,
        'lang': BRANDING.lang,
        'primaryColor': BRANDING.primaryColor,
        'primaryTextColor': BRANDING.primaryTextColor,
        'secondaryColor': BRANDING.secondaryColor,
        'background': BRANDING.background,
        'successColor': BRANDING.successColor,
        'warningColor': BRANDING.warningColor,
        'infoColor': BRANDING.infoColor,
        'hideNetworkSwitch': BRANDING.hideNetworkSwitch,
        'net': params.net || 'matic_mainnet',
        'addr': params.addr || '',
        'code': params.code || '',
        'hash': params.hash || ''
      };

      if (tab === 'sell') {
        baseParams.ssc = params.ssc;
        baseParams.sdc = params.sdc;
        baseParams.ssa = params.ssa || '100';
        baseParams.snet = params.snet || 'matic_mainnet';
      } else {
        baseParams.bsc = params.bsc;
        baseParams.bdc = params.bdc;
        baseParams.bsa = params.bsa || '100';
        baseParams.dnet = params.dnet || 'matic_mainnet';
        baseParams.pm = params.pm || 'card';
      }

      Object.keys(baseParams).forEach(key => {
        if (baseParams[key] === '') delete baseParams[key];
      });

      return `https://widget.mtpelerin.com/?${new URLSearchParams(baseParams).toString()}`;
    }

    function initializeApp() {
      const result = parseUrlParameters();
      if (!result.valid) return;

      const url = formatWidgetUrl(result.params, result.tab);
      document.getElementById('widget').src = url;
    }

    document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
</body>
</html>
